<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geometric Dash Clone</title>
    <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: black;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
<script>
let player;
let obstacles = [];
let score = 0;
let highScore = 0;
let isJumping = false;
let jumpForce = 0;
let gravity = 2.6;
let playerSpeed = 4;
let groundHeight = 100;
let playerRotation = 0;
let rotationSpeed = -5.3;
let gameOver = false;
let cameraX = 0;

function setup() {
    createCanvas(1280, 720);
    player = new Player(50, height - groundHeight - 50, 50, color(255, 255, 0));
    textSize(45);
}

function draw() {
    background(0);

    // Desenhar e atualizar jogador
    if (!gameOver) {
        player.update();
        player.show();
    }

    // Gerar obstáculos
    if (frameCount % int(random(30, 100)) === 0) {
        obstacles.push(new Obstacle(width + cameraX, height - groundHeight - 40, 40));
    }

    // Desenhar e atualizar obstáculos
    for (let i = obstacles.length - 1; i >= 0; i--) {
        obstacles[i].update();
        obstacles[i].show();

        // Verificar colisão
        if (player.hits(obstacles[i])) {
            gameOver = true;
        }

        // Remover obstáculos fora da tela
        if (obstacles[i].offscreen()) {
            obstacles.splice(i, 1);
            score++;
        }
    }

    // Mostrar pontuação
    fill(255);
    text("Score: " + score, 10, 50);
    text("High Score: " + highScore, width - 250, 50);

    if (gameOver) {
        fill(255);
        textAlign(CENTER);
        textSize(100);
        text("Game Over", width / 2, height / 2);
        textSize(36);
        text("Clique para reiniciar", width / 2, height / 2 + 100);
    }
}

function mousePressed() {
    if (gameOver) {
        gameOver = false;
        score = 0;
        player = new Player(50, height - groundHeight - 50, 50, color(255, 255, 0));
        obstacles = [];
    } else if (!isJumping) {
        isJumping = true;
        jumpForce = -20;
    }
}

class Player {
    constructor(x, y, size, col) {
        this.x = x;
        this.y = y;
        this.size = size;
        this.col = col;
        this.gravity = gravity;
        this.velocity = 0;
        this.rotation = 0;
    }

    update() {
        this.y += this.velocity;
        this.velocity += this.gravity;

        if (this.y > height - this.size - groundHeight) {
            this.y = height - this.size - groundHeight;
            this.velocity = 0;
            isJumping = false;
        }

        cameraX = this.x - width / 7;
    }

    show() {
        push();
        translate(this.x - cameraX, this.y);
        rotate(radians(this.rotation));
        fill(this.col);
        rectMode(CENTER);
        rect(0, 0, this.size, this.size);
        pop();
    }

    hits(obstacle) {
        return collideRectRect(this.x, this.y, this.size, this.size, obstacle.x - cameraX, obstacle.y, obstacle.size, obstacle.size);
    }
}

class Obstacle {
    constructor(x, y, size) {
        this.x = x;
        this.y = y;
        this.size = size;
    }

    update() {
        this.x -= playerSpeed;
    }

    show() {
        fill(0);
        stroke(255);
        strokeWeight(3);
        push();
        translate(this.x - cameraX, this.y);
        triangle(0, this.size, this.size, this.size, this.size / 2, 0);
        pop();
    }

    offscreen() {
        return this.x - cameraX < -this.size;
    }
}
</script>

</body>
</html>
